-- -------------------------------------------------------------
-- 6. both
-- Report for each player the player's gender as “female” or “male”, and the “gender” of his or her avatars (in column avatars).
-- If a player has avatars of only one gender, show that gender (“female” or “male”);
-- otherwise display the word “both”.
-- schema: login, gender, avatars
-- order by login
SELECT
  A.login,
  A.Gender,
  B.avatars
FROM (SELECT
        P.login,
        'male' AS Gender
      FROM Player AS P
      WHERE P.gender = 'M'
      UNION
      SELECT
        P.login,
        'female' AS Gender
      FROM Player AS P
      WHERE P.gender = 'F') AS A
  JOIN (SELECT
          login,
          'both' AS avatars
        FROM (SELECT A.login
              FROM (SELECT
                      login,
                      gender
                    FROM Avatar
                    GROUP BY login, gender) AS A
              GROUP BY A.login
              HAVING count(*) = 2)
        UNION
        SELECT DISTINCT
          T1.login,
          'male' AS avatars
        FROM (SELECT A.login
              FROM (SELECT
                      login,
                      gender
                    FROM Avatar
                    GROUP BY login, gender) AS A
              GROUP BY A.login
              HAVING count(*) = 1) AS T1
          INNER JOIN
          Avatar AS A
            ON T1.login = A.login
        WHERE gender = 'M'
        UNION
        SELECT DISTINCT
          T1.login,
          'female' AS avatars
        FROM (SELECT A.login
              FROM (SELECT
                      login,
                      gender
                    FROM Avatar
                    GROUP BY login, gender) AS A
              GROUP BY A.login
              HAVING count(*) = 1) AS T1
          INNER JOIN
          Avatar AS A
            ON T1.login = A.login
        WHERE gender = 'F') AS B ON A.login = B.login
ORDER BY A.login;